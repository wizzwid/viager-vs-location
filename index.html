<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- ====== SEO de base ====== -->
    <title>Calculette Immo – Simulation Viager, Location, SCPI & Local commercial</title>
    <meta name="description" content="Calculette Immo : le calculateur immobilier qui compare viager, location, SCPI et local commercial. Entrez vos hypothèses et obtenez la rentabilité nette, cashflow et TRI." />
    <link rel="canonical" href="https://wizzwid.github.io/viager-vs-location/" />
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />

    <!-- ====== Open Graph / Twitter (partages + CTR) ====== -->
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="fr_FR" />
    <meta property="og:site_name" content="Calculette Immo" />
    <meta property="og:title" content="Calculette Immo – Comparez Viager, Location, SCPI" />
    <meta property="og:description" content="Le calculateur immobilier de référence pour comparer viager, location, SCPI et local commercial." />
    <meta property="og:url" content="https://wizzwid.github.io/viager-vs-location/" />
    <meta property="og:image" content="https://wizzwid.github.io/viager-vs-location/og-image.jpg" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Calculette Immo – Comparez Viager, Location, SCPI" />
    <meta name="twitter:description" content="Entrez vos données et obtenez rentabilité, cashflow et TRI en 1 clic." />
    <meta name="twitter:image" content="https://wizzwid.github.io/viager-vs-location/og-image.jpg" />

    <!-- (facultatif) Vérification Search Console : remplace le content par ta valeur -->
    <!-- <meta name="google-site-verification" content="_________TA_CLEF_VERIF_________"> -->

    <!-- ====== PWA / Manifest / Icônes ====== -->
    <link rel="manifest" href="/viager-vs-location/manifest.json" />
    <link rel="icon" href="/viager-vs-location/icons/favicon-32.png" sizes="32x32" />
    <link rel="icon" href="/viager-vs-location/icons/favicon-192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="/viager-vs-location/icons/apple-touch-icon.png" />
    <meta name="theme-color" content="#0b5cff" />

    <!-- ====== Performance hints ====== -->
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="preload" as="script" href="/src/main.tsx" />

    <!-- ====== Données structurées (Website + SoftwareApplication + FAQ) ====== -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebSite",
          "name": "Calculette Immo",
          "url": "https://wizzwid.github.io/viager-vs-location/",
          "potentialAction": {
            "@type": "SearchAction",
            "target": "https://wizzwid.github.io/viager-vs-location/#simulateur?query={search_term_string}",
            "query-input": "required name=search_term_string"
          }
        },
        {
          "@type": "SoftwareApplication",
          "name": "Calculette Immo",
          "applicationCategory": "FinanceApplication",
          "operatingSystem": "Web",
          "offers": { "@type": "Offer", "price": "0", "priceCurrency": "EUR" },
          "url": "https://wizzwid.github.io/viager-vs-location/"
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Comment comparer viager, location, SCPI et local commercial ?",
              "acceptedAnswer": { "@type": "Answer", "text": "Renseignez prix, apport, loyers/rente, charges et fiscalité. La calculette calcule rentabilité nette, cashflow et TRI." }
            },
            {
              "@type": "Question",
              "name": "Les résultats tiennent-ils compte de la fiscalité ?",
              "acceptedAnswer": { "@type": "Answer", "text": "Oui, vous pouvez paramétrer les taux d'imposition et prélèvements sociaux. Les calculs s’adaptent automatiquement." }
            },
            {
              "@type": "Question",
              "name": "Puis-je enregistrer ou partager une simulation ?",
              "acceptedAnswer": { "@type": "Answer", "text": "Oui, le lien contient vos paramètres. Vous pouvez l’ajouter aux favoris ou le partager." }
            }
          ]
        }
      ]
    }
    </script>

    <!-- ====== Consentement & Google Analytics 4 (avec anonymisation + SPA) ====== -->
    <style>
      /* Bandeau de consentement minimal */
      #cookie-banner {
        position: fixed; left: 0; right: 0; bottom: 0;
        padding: 12px 16px; background: #111; color: #fff;
        display: none; z-index: 9999;
        font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }
      #cookie-banner .btns { display:inline-flex; gap: 8px; margin-left: 12px; }
      #cookie-banner button {
        border: 0; padding: 8px 12px; cursor: pointer; border-radius: 6px;
      }
      #cookie-accept { background:#2ea44f; color:#fff; }
      #cookie-reject { background:#444; color:#fff; }
    </style>

    <script>
      (function () {
        // ---- ID Google Analytics 4 ----
        var GA_MEASUREMENT_ID = 'G-GSTWDG9DLW';

        var KEY = 'cookie_consent';
        var consent = localStorage.getItem(KEY);

        // Injection du script GA4 après consentement
        function loadGA() {
          var s = document.createElement('script');
          s.async = true;
          s.src = "https://www.googletagmanager.com/gtag/js?id=" + GA_MEASUREMENT_ID;
          document.head.appendChild(s);

          window.dataLayer = window.dataLayer || [];
          function gtag(){ dataLayer.push(arguments); }
          window.gtag = gtag;

          gtag('js', new Date());
          gtag('config', GA_MEASUREMENT_ID, {
            anonymize_ip: true,
            send_page_view: false
          });

          // Tracking SPA (hash et history)
          function sendPageView() {
            const path = location.pathname + location.search + location.hash;
            gtag('event', 'page_view', {
              page_location: location.href,
              page_path: path,
              page_title: document.title || 'Calculette Immo'
            });
          }
          sendPageView();

          const _push = history.pushState;
          const _replace = history.replaceState;
          history.pushState = function() { _push.apply(this, arguments); setTimeout(sendPageView, 0); };
          history.replaceState = function() { _replace.apply(this, arguments); setTimeout(sendPageView, 0); };
          window.addEventListener('popstate', sendPageView);
          window.addEventListener('hashchange', sendPageView);
        }

        function showBanner() {
          const b = document.getElementById('cookie-banner');
          if (b) b.style.display = 'block';
        }
        function hideBanner() {
          const b = document.getElementById('cookie-banner');
          if (b) b.style.display = 'none';
        }

        if (consent === 'yes') {
          loadGA();
        } else if (consent === null) {
          document.addEventListener('DOMContentLoaded', showBanner);
        }

        window.__cookieAccept = function() {
          localStorage.setItem(KEY, 'yes');
          hideBanner();
          loadGA();
        };
        window.__cookieReject = function() {
          localStorage.setItem(KEY, 'no');
          hideBanner();
        };
      })();
    </script>
  </head>

  <body>
    <!-- Bandeau de consentement -->
    <div id="cookie-banner" role="dialog" aria-live="polite">
      Nous utilisons des cookies de mesure d’audience (Google Analytics) pour améliorer le site.
      <div class="btns">
        <button id="cookie-accept" onclick="__cookieAccept()">Accepter</button>
        <button id="cookie-reject" onclick="__cookieReject()">Refuser</button>
      </div>
    </div>

    <!-- ====== App ====== -->
    <div id="root"></div>

    <!-- IMPORTANT pour GitHub Pages + Vite -->
    <script type="module" src="/src/main.tsx"></script>

    <!-- ====== Définir le calculateur comme écran par défaut (si hash manquant) ====== -->
    <script>
      (function ensureDefaultRoute() {
        // Si aucun hash, force l’arrivée sur le simulateur (ex: #/simulateur ou #simulateur selon ton router)
        if (!location.hash) {
          // Adapte la route à ton Router (ex: "#/simulateur")
          location.replace(location.pathname + location.search + "#/simulateur");
        }
      })();
    </script>
  </body>
</html>
